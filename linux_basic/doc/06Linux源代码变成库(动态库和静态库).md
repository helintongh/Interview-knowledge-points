### 源代码变成库

本文主要讲解:静态库和动态库的制作和使用。

要搞清楚库要先弄明白三个问题?

1. 库是什么?

- 二进制文件

- 将源代码编译 -> 二进制格式的源代码

- 加密后的源代码

2. 如何使用库?

- 引入头文件

- 要制作出库(库有分为静态和动态,其中动态库使用更多)

动态库在linux中是`.so` 后缀的文件,而静态库是`.a`后缀的文件

#### 静态库的制作和使用

- 命名规则
	- lib作为前缀
	
	- 中间为库的名字
	
	- `.a`为后缀

比如:`libtest.a` 就是在linux下很明显的一个静态库。

制作静态库的步骤:

- 1. 准备原材料: 源代码,.c,.cpp等源文件

- 2. 将.c文件生成 .o `gcc a.c b.c -c`

- 3. 将.o文件打包

	- `ar rcs 静态库名字 原材料`

	- `ar rcs libtest.a a.o b.o`

假设有路径为下的项目
```
----lib/
|
|---include/
|---main.c
|---src/
```

src和include路径下的文件是函数的实现,main.c是主函数。lib是存放src和include打包后静态库的路径。

```Shell
gcc *.c -c -I ../include # -I是指定头文件路径,该语句是把当前路径下的.c文件编译为.o

ar rcs libmycalc.a *.o # 把所有.o打包成静态库libmycalc.a

nm libmycalc.a # 查看静态库的内容
# 在编成静态库后去掉src目录依然运行
```

库的使用如下:

```Shell
gcc main.c -I ./include -L ./lib -l mycalc -o app
```

其中大写的-L是指定静态库的目录,而小写-l是指定静态库名称。

下面是总结

- `-L`参数是指定库的路径

- `-l`参数是库名字(去掉了lib和.a)

#### 动态库的制作和使用

- 命名规则
	- libxxx.so

- 制作动态库步骤

	- 1. 将源文件生成.o `gcc *.c -c -fpic` 
	- 2. 打包所有.o `gcc -`